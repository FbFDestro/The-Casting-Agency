# The-Casting-Agency

Live at: [https://fbfdestro-casting-agency.herokuapp.com/](https://fbfdestro-casting-agency.herokuapp.com/)

This is the capstone project for Udacity's Fullstack Nanodegree program and it's a server to a casting agency.

The Casting Agency models a company that is responsible for creating movies and managing and assigning actors to those movies. You are an Executive Producer within the company and are creating a system to simplify and streamline your process.

- [Installing Dependencies](#installing-dependencies)
- [Database Setup](#database-setup)
- [Testing](#testing)
- [API and Authentication](#api)
- [Error Handling](#error-handling)

## Installing Dependencies

### Python 3.7

Follow instructions to install the latest version of python for your platform in the python docs

### Virtual Enviornment

It's recommend working within a virtual environment whenever using Python for projects. This keeps your dependencies for each project separate and organaized. Instructions for setting up a virual enviornment for your platform can be found in the python docs

### PIP Dependencies

Once you have your virtual environment setup and running, install dependencies by naviging to the /backend directory and running:

`pip install -r requirements.txt`

This will install all of the required packages we selected within the requirements.txt file.

**Key Dependencies**

- Flask is a lightweight backend microservices framework. Flask is required to handle requests and responses.

- SQLAlchemy and Flask-SQLAlchemy are libraries to handle the lightweight sqlite database. Since we want you to focus on auth, we handle the heavy lift for you in ./src/database/models.py. We recommend skimming this code first so you know how to interface with the Drink model.

- Flask-CORS is the extension we'll use to handle cross origin requests from our frontend server.

- jose JavaScript Object Signing and Encryption for JWTs. Useful for encoding, decoding, and verifying JWTS.

## Database Setup

The project uses Postgresql as its database, you would need to create one locally and reflect it in setup.sh or use the production database hosted on Heroku. To update the database and seed run the following:

```
python manage.py db upgrade
python manage.py seed
```

- you may need to change the database url in setup.sh after which you can run
  `source setup.sh`
- Start server by running
  `flask run`

## Testing

It's needed to replace the jwt tokens in test_app.py with new and valid ones. To generate JWT tokens, it's possible to login using the Auth0 login page given on the main page.

For testing locally, we need to reset database. To reset database, run

```
python manage.py db downgrade
python manage.py db upgrade
python manage.py seed
```

## API

In order to use the API users need to be authenticated. Jwt tokens can be generated by logging in with the provided credentials on the hosted site.

One can valid tokens using the given credentials on [https://fbfdestro-casting-agency.herokuapp.com/](https://fbfdestro-casting-agency.herokuapp.com/) or locally using [http://localhost:5000/](http://localhost:5000/).

### GET /movies

- General:
  - Returns all the movies.
  - Roles authorized : Casting Assistant, Casting Director, Executive Producer.
- Sample: curl http://127.0.0.1:5000/movies

```
{
    "movies": [
        {
            "id": 1,
            "release_date": "Wed, 31 Mar 1999 00:00:00 GMT",
            "title": "The Matrix"
        },
        {
            "id": 2,
            "release_date": "Fri, 17 Jun 2005 00:00:00 GMT",
            "title": "Batman Begins"
        }
    ],
    "success": true
}
```

### GET /movies/<int:id>

- General:
  - Get a specific movie.
  - Roles authorized : Casting Assistant, Casting Director, Executive Producer.
- Sample: curl http://127.0.0.1:5000/movies/1

```
{
    "movie": {
        "id": 1,
        "release_date": "Wed, 31 Mar 1999 00:00:00 GMT",
        "title": "The Matrix"
    },
    "success": true
}
```

### POST /movies

- General:
  - Creates a new movie
  - Roles authorized : Executive Producer.
- Sample: curl http://127.0.0.1:5000/movies -X POST -H "Content-Type: application/json" -d '{ "title": "New Movie", "release_date": "2020-11-11" }'

```
{
    "movie": {
        "id": 3,
        "release_date": "Wed, 11 Nov 2020 00:00:00 GMT",
        "title": "New Movie"
    },
    "success": true
}
```

### PATCH /movies/<int:id>

- General:
  - Patches a movie
  - Roles authorized : Casting Director, Executive Producer.
- Sample: curl http://127.0.0.1:5000/movies/3 -X POST -H "Content-Type: application/json" -d '{ "title": "New title", "release_date": "2020-11-11" }'

```
{
    "movie": {
        "id": 3,
        "release_date": "Wed, 11 Nov 2020 00:00:00 GMT",
        "title": "New title"
    },
    "success": true
}
```

---

### DELETE /movies/<int:id\>

- General:

  - Deletes a movies by id
  - Roles authorized : Executive Producer.

- Sample: `curl http://127.0.0.1:5000/movies/3 -X DELETE`

```
{
    "movie": {
        "id": 3,
        "release_date": "Wed, 11 Nov 2020 00:00:00 GMT",
        "title": "New title"
    },
    "success": true
}

```

### GET /actors

- General:

  - Returns all the actors.
  - Roles authorized : Casting Assistant,Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors`

```
{
    "actors": [
        {
            "age": 56,
            "gender": "male",
            "id": 1,
            "name": "Keanu Reeves"
        },
        {
            "age": 46,
            "gender": "male",
            "id": 2,
            "name": "Christian Bale"
        }
    ],
    "success": true
}
```

### GET /actors/\<int:id\>

- General:

  - Get a specific actor by id.
  - Roles authorized : Casting Assistant,Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors/1`

```
{
    "actor": {
        "age": 56,
        "gender": "male",
        "id": 1,
        "name": "Keanu Reeves"
    },
    "success": true
}
```

### POST /actors

- General:

  - Creates a new actor
  - Roles authorized : Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors -X POST -H "Content-Type: application/json" -d '{ "name": "New actor", "age": 22, "gender": "female" }'`

```
{
    "actor": {
        "age": 22,
        "gender": "female",
        "id": 3,
        "name": "New actor"
    },
    "success": true
}
```

### PATCH /actors/\<int:id\>

- General:

  - Patches an actor
  - Roles authorized : Casting Director, Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors/3 -X POST -H "Content-Type: application/json" -d '{ "name": "New actor name", "age": 22, "gender": "female" }'`

```
{
    "actor": {
        "age": 22,
        "gender": "female",
        "id": 3,
        "name": "New actor name"
    },
    "success": true
}}
```

### DELETE /actors/<int:id\>

- General:

  - Deletes an actor by id
  - Roles authorized : Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors/3 -X DELETE`

```
{
    "actor": {
        "age": 22,
        "gender": "female",
        "id": 3,
        "name": "New actor"
    },
    "success": true
}
```

## Error Handling

- 401 errors due to RBAC are returned as

```
{
  "code": "unauthorized",
  "description": "Permission not found."
}
```

Other Errors are returned in the following json format:

```
{
  "success": "False",
  "error": 422,
  "message": "Unprocessable entity"
}
```

The error codes currently returned are:

- 400 – bad request
- 401 – unauthorized
- 404 – resource not found
- 422 – unprocessable
- 500 – internal server error
